import{j as e}from"./jsx-runtime.DeqwNDbN.js";import{r as a}from"./index.DbYiSJ-C.js";import{s as w}from"./supabase.kJRL6j1B.js";import{n as l}from"./index.41d0IwRH.js";import{z as N,y as k}from"./dialog.Cigdy6Vf.js";import"./index.DTt_QiUe.js";function E({isOpen:p,onClose:n,onProductSaved:f,categories:v,editingProduct:s}){const[h,i]=a.useState(""),[g,d]=a.useState(""),[c,u]=a.useState(""),[y,m]=a.useState(""),[t,o]=a.useState(""),[b,F]=a.useState(!1);a.useEffect(()=>{s?(i(s.name),d(s.description),u(s.price.toString()),m(s.category_id.toString()),o(s.image_url||"")):S()},[s]);function S(){i(""),d(""),u(""),m(""),o("")}async function C(r){r.preventDefault(),F(!0);try{const j={name:h,description:g,price:parseFloat(c),category_id:parseInt(y),image_url:t||null};if(s){const{error:x}=await w.from("products").update(j).eq("id",s.id);if(x)throw x;l.success("Product updated successfully")}else{const{error:x}=await w.from("products").insert([j]);if(x)throw x;l.success("Product added successfully")}f(),S()}catch(j){console.error("Error saving product:",j),l.error(s?"Failed to update product":"Failed to add product")}finally{F(!1)}}return e.jsx(N,{appear:!0,show:p,as:a.Fragment,children:e.jsxs(k,{as:"div",className:"relative z-10",onClose:n,children:[e.jsx(N.Child,{as:a.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25"})}),e.jsx("div",{className:"fixed inset-0 overflow-y-auto",children:e.jsx("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:e.jsx(N.Child,{as:a.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e.jsxs(k.Panel,{className:"w-full max-w-md transform overflow-hidden rounded-2xl bg-white p-6 text-left align-middle shadow-xl transition-all",children:[e.jsx(k.Title,{as:"h3",className:"text-lg font-medium leading-6 text-gray-900 mb-4",children:s?"Edit Product":"Add New Product"}),e.jsxs("form",{onSubmit:C,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Name"}),e.jsx("input",{type:"text",id:"name",value:h,onChange:r=>i(r.target.value),required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("textarea",{id:"description",value:g,onChange:r=>d(r.target.value),rows:3,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"price",className:"block text-sm font-medium text-gray-700",children:"Price"}),e.jsx("input",{type:"number",id:"price",value:c,onChange:r=>u(r.target.value),required:!0,step:"0.01",min:"0",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"category",className:"block text-sm font-medium text-gray-700",children:"Category"}),e.jsxs("select",{id:"category",value:y,onChange:r=>m(r.target.value),required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",children:[e.jsx("option",{value:"",children:"Select a category"}),v.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"imageUrl",className:"block text-sm font-medium text-gray-700",children:"Image URL (optional)"}),e.jsx("input",{type:"url",id:"imageUrl",value:t,onChange:r=>o(r.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:n,className:"rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:b,className:"rounded-md bg-blue-500 px-4 py-2 text-sm font-medium text-white hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50",children:b?"Saving...":s?"Update":"Add"})]})]})]})})})})]})})}function L({categories:p}){const[n,f]=a.useState([]),[v,s]=a.useState(!1),[h,i]=a.useState(null),[g,d]=a.useState(!0);a.useEffect(()=>{c()},[]);async function c(){try{const{data:t,error:o}=await w.from("products").select("*").order("name");if(o)throw o;f(t||[])}catch(t){console.error("Error fetching products:",t),l.error("Failed to load products")}finally{d(!1)}}async function u(t){if(confirm("Are you sure you want to delete this product?"))try{const{error:o}=await w.from("products").delete().eq("id",t);if(o)throw o;f(n.filter(b=>b.id!==t)),l.success("Product deleted successfully")}catch(o){console.error("Error deleting product:",o),l.error("Failed to delete product")}}async function y(t){i(t),s(!0)}function m(t){return p.find(o=>o.id===t)?.name||"Unknown Category"}return g?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{children:[e.jsx("div",{className:"mb-4",children:e.jsx("button",{onClick:()=>{i(null),s(!0)},className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition-colors",children:"Add New Product"})}),e.jsx("div",{className:"bg-white shadow-md rounded-lg overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Price"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Category"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:n.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.name}),e.jsx("td",{className:"px-6 py-4",children:t.description}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:["$",t.price.toFixed(2)]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:m(t.category_id)}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("button",{onClick:()=>y(t),className:"text-indigo-600 hover:text-indigo-900 mr-4",children:"Edit"}),e.jsx("button",{onClick:()=>u(t.id),className:"text-red-600 hover:text-red-900",children:"Delete"})]})]},t.id))})]})}),e.jsx(E,{isOpen:v,onClose:()=>{s(!1),i(null)},onProductSaved:()=>{c(),s(!1),i(null)},categories:p,editingProduct:h})]})}export{L as default};
